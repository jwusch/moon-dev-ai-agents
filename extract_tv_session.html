<!DOCTYPE html>
<html>
<head>
    <title>TradingView Session Extractor</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #4a9eff;
            border-radius: 5px;
        }
        .code {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        button {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
        }
        button:hover {
            background: #3a8eef;
        }
        .result {
            display: none;
            margin: 20px 0;
            padding: 20px;
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 5px;
        }
        .error {
            background: #ffebee;
            border-color: #f44336;
        }
        textarea {
            width: 100%;
            height: 120px;
            font-family: monospace;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
        }
        .copy-btn {
            background: #4caf50;
            padding: 8px 16px;
            font-size: 14px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üç™ TradingView Session Extractor</h1>
        
        <div class="step">
            <h3>Step 1: Login to TradingView</h3>
            <p>First, make sure you're logged into TradingView:</p>
            <button onclick="window.open('https://www.tradingview.com/accounts/signin/', '_blank')">
                Open TradingView Login
            </button>
        </div>
        
        <div class="step">
            <h3>Step 2: Extract Session</h3>
            <p>After logging in, open this page in the same browser and click the button below:</p>
            <button onclick="extractSession()">
                üîç Extract Session Tokens
            </button>
            
            <p style="font-size: 14px; color: #666; margin-top: 15px;">
                <strong>Note:</strong> This must be done on the TradingView domain. 
                You'll need to run the JavaScript in the browser console while on tradingview.com.
            </p>
        </div>
        
        <div class="step">
            <h3>Step 3: Manual Console Method</h3>
            <p>Copy this code and run it in the browser console (F12) while on tradingview.com:</p>
            <div class="code" id="consoleCode">// Extract TradingView session tokens
const cookies = document.cookie.split('; ');
const sessionid = cookies.find(c => c.startsWith('sessionid='))?.split('=')[1];
const sessionid_sign = cookies.find(c => c.startsWith('sessionid_sign='))?.split('=')[1];

if (sessionid && sessionid_sign) {
    console.log('‚úÖ Session tokens found!\n');
    console.log('Add these to your .env file:\n');
    console.log(`TV_SESSION_ID=${sessionid}`);
    console.log(`TV_SESSION_SIGNATURE=${sessionid_sign}`);
    
    // Also copy to clipboard
    const envContent = `TV_SESSION_ID=${sessionid}\nTV_SESSION_SIGNATURE=${sessionid_sign}`;
    navigator.clipboard.writeText(envContent).then(() => {
        console.log('\nüìã Copied to clipboard!');
    });
} else {
    console.error('‚ùå Session tokens not found. Make sure you are logged in!');
}</div>
            <button class="copy-btn" onclick="copyConsoleCode()">üìã Copy Code</button>
        </div>
        
        <div id="result" class="result">
            <h3>‚úÖ Session Tokens for .env</h3>
            <p>Add these lines to your .env file:</p>
            <textarea id="envContent" readonly></textarea>
            <button class="copy-btn" onclick="copyEnvContent()">üìã Copy to Clipboard</button>
        </div>
        
        <div class="step">
            <h3>Step 4: Update Your .env File</h3>
            <p>After extracting the tokens, add them to your <code>.env</code> file and restart the server:</p>
            <div class="code">cd tradingview-server
node server-session.js</div>
        </div>
        
        <div class="step" style="background: #fff3cd; border-color: #ffc107;">
            <h3>‚ö†Ô∏è Important Notes</h3>
            <ul>
                <li>Session tokens expire (usually after a few hours/days)</li>
                <li>You'll need to re-extract when they expire</li>
                <li>Keep these tokens secure - they provide full account access</li>
                <li>The tokens only work from the same IP address</li>
            </ul>
        </div>
    </div>

    <script>
        function extractSession() {
            alert('Due to browser security, you need to:\n\n1. Copy the console code below\n2. Open tradingview.com\n3. Press F12 to open console\n4. Paste and run the code\n5. Copy the result to your .env file');
            
            // Highlight the console code
            document.getElementById('consoleCode').style.background = '#ff0';
            document.getElementById('consoleCode').style.color = '#000';
            setTimeout(() => {
                document.getElementById('consoleCode').style.background = '#000';
                document.getElementById('consoleCode').style.color = '#0f0';
            }, 2000);
        }
        
        function copyConsoleCode() {
            const code = document.getElementById('consoleCode').innerText;
            navigator.clipboard.writeText(code).then(() => {
                alert('‚úÖ Code copied! Now:\n\n1. Go to tradingview.com\n2. Press F12\n3. Paste in console\n4. Press Enter');
            });
        }
        
        function copyEnvContent() {
            const content = document.getElementById('envContent').value;
            navigator.clipboard.writeText(content).then(() => {
                alert('‚úÖ Copied to clipboard!');
            });
        }
        
        // Check if we're on TradingView domain
        if (window.location.hostname.includes('tradingview.com')) {
            // Auto-run extraction
            const cookies = document.cookie.split('; ');
            const sessionid = cookies.find(c => c.startsWith('sessionid='))?.split('=')[1];
            const sessionid_sign = cookies.find(c => c.startsWith('sessionid_sign='))?.split('=')[1];
            
            if (sessionid && sessionid_sign) {
                const envContent = `TV_SESSION_ID=${sessionid}\nTV_SESSION_SIGNATURE=${sessionid_sign}`;
                document.getElementById('envContent').value = envContent;
                document.getElementById('result').style.display = 'block';
            }
        }
    </script>
</body>
</html>