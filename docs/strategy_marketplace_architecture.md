# Strategy Marketplace Architecture

## Overview

The Strategy Marketplace is a community-driven platform within the Moon Dev AI Trading ecosystem that allows users to share, discover, and analyze proven trading strategies with comprehensive performance metrics.

## Core Components

### 1. Strategy Registry Agent (`strategy_registry_agent.py`)

**Purpose**: Manages the complete lifecycle of trading strategies including registration, versioning, validation, and retrieval.

**Key Functions:**
- Register new strategies with metadata
- Validate strategy code for safety and compatibility
- Version control integration
- Performance tracking linkage
- Search and discovery features

### 2. Performance Analytics Module (`strategy_analytics.py`)

**Purpose**: Calculates and tracks comprehensive performance metrics for each strategy across different market conditions.

**Key Metrics:**
- Return percentage (daily, weekly, monthly, yearly)
- Sharpe ratio
- Sortino ratio
- Maximum drawdown
- Win rate
- Profit factor
- Average trade duration
- Market correlation

### 3. Strategy Data Models

```python
# Strategy Metadata Schema
{
    "strategy_id": "uuid",
    "name": "string",
    "description": "string",
    "author": "string",
    "version": "semver",
    "created_at": "timestamp",
    "updated_at": "timestamp",
    "category": ["momentum", "mean_reversion", "ml_based", etc.],
    "timeframes": ["15m", "1H", "4H", etc.],
    "instruments": ["BTC", "ETH", "SOL", etc.],
    "min_capital": "float",
    "risk_level": ["low", "medium", "high"],
    "dependencies": ["pandas_ta", "talib", etc.],
    "performance_summary": {},
    "rating": {
        "average": "float",
        "count": "int"
    },
    "downloads": "int",
    "github_url": "string",
    "status": ["active", "deprecated", "under_review"]
}

# Performance Data Schema
{
    "strategy_id": "uuid",
    "backtest_id": "uuid",
    "period": {
        "start": "timestamp",
        "end": "timestamp"
    },
    "metrics": {
        "total_return": "float",
        "sharpe_ratio": "float",
        "sortino_ratio": "float",
        "max_drawdown": "float",
        "win_rate": "float",
        "profit_factor": "float",
        "total_trades": "int",
        "winning_trades": "int",
        "losing_trades": "int",
        "avg_win": "float",
        "avg_loss": "float",
        "best_trade": "float",
        "worst_trade": "float",
        "avg_trade_duration": "float",
        "exposure_time": "float"
    },
    "market_conditions": {
        "trend": ["bull", "bear", "sideways"],
        "volatility": ["low", "medium", "high"]
    },
    "tested_on": ["BTC-USD", "ETH-USD", etc.],
    "backtest_config": {
        "initial_capital": "float",
        "commission": "float",
        "slippage": "float"
    }
}
```

## Architecture Flow

```
┌─────────────────────────────────────────────────────────────┐
│                   Strategy Marketplace                       │
│                                                             │
│  ┌─────────────┐    ┌──────────────┐    ┌───────────────┐ │
│  │   Author    │───▶│   Registry   │───▶│  Performance  │ │
│  │  Submits    │    │    Agent     │    │   Analytics   │ │
│  │  Strategy   │    │              │    │               │ │
│  └─────────────┘    └──────┬───────┘    └───────┬───────┘ │
│                            │                     │          │
│                            ▼                     ▼          │
│                    ┌───────────────┐    ┌───────────────┐  │
│                    │   Strategy    │    │   Metrics     │  │
│                    │   Database    │    │   Database    │  │
│                    └───────┬───────┘    └───────┬───────┘  │
│                            │                     │          │
│                            ▼                     ▼          │
│  ┌─────────────┐    ┌──────────────────────────────┐      │
│  │    User     │◀───│    Marketplace Dashboard     │      │
│  │  Discovers  │    │  (Web UI + API Endpoints)    │      │
│  │  Strategy   │    └──────────────────────────────┘      │
│  └─────────────┘                                           │
└─────────────────────────────────────────────────────────────┘
```

## Integration Points

### 1. RBI Agent Integration
- Strategies generated by RBI agent can be auto-submitted to marketplace
- Performance data from RBI backtests feeds into analytics

### 2. Existing Strategy System
- Compatible with current `src/strategies/` folder structure
- Extends `BaseStrategy` class with marketplace metadata

### 3. Backtest Dashboard Integration
- Leverage existing web dashboard at `src/data/rbi_pp_multi/app.py`
- Add marketplace views and search functionality

## File Structure

```
src/
├── agents/
│   └── strategy_registry_agent.py    # New registry agent
├── marketplace/
│   ├── __init__.py
│   ├── analytics.py                  # Performance analytics
│   ├── models.py                     # Data models
│   ├── validator.py                  # Strategy validation
│   └── exporter.py                   # Export/import tools
├── data/
│   └── marketplace/
│       ├── strategies/               # Strategy files
│       ├── metrics/                  # Performance data
│       └── registry.json             # Strategy registry
└── scripts/
    └── marketplace_dashboard.py      # Enhanced dashboard
```

## Implementation Priority

1. **Phase 1 - Core Registry (Week 1)**
   - Basic strategy registration
   - File-based storage
   - Simple validation

2. **Phase 2 - Analytics Integration (Week 2)**
   - Connect to existing backtest results
   - Calculate standard metrics
   - Store performance data

3. **Phase 3 - Marketplace UI (Week 3)**
   - Search and filter strategies
   - View performance charts
   - Download strategies

4. **Phase 4 - Community Features (Week 4)**
   - GitHub integration
   - Rating system
   - Usage tracking

## Security Considerations

1. **Code Validation**
   - No execution of arbitrary code
   - Whitelist allowed imports
   - Validate against BaseStrategy interface

2. **Data Privacy**
   - Authors can choose to share or hide certain metrics
   - API keys never included in shared strategies
   - User download history private by default

3. **Quality Control**
   - Minimum backtest requirements before publishing
   - Community flagging for suspicious strategies
   - Automated checks for common issues

## Success Metrics

1. **Adoption Metrics**
   - Number of strategies submitted
   - Active monthly users
   - Download count per strategy

2. **Quality Metrics**
   - Average strategy performance
   - User ratings distribution
   - Successful deployment rate

3. **Community Metrics**
   - GitHub stars on shared strategies
   - Discord discussions about strategies
   - User-generated improvements